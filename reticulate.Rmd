# reticulate

RとPythonのパッケージは，相互に移植されていることが多い．
例えば，Pythonのlogging(とRのfutile.logger)をもとにRのパッケージloggerは開発されている．
https://cran.r-project.org/web/packages/logger/index.html
また，Rのggplot2やdplyrはPythonにも移植されている．

ただし，どちらか片方でしか利用できなかったり，使用方法が難しいことがある．
そんなとき，ちょっとだけ使うのであれば，Rのパッケージreticulateが便利である．
もちろん，Pythonをちゃんと勉強するのも良いだろう．
さらに，reticulateを使うとRとPythonとの変数のやり取りが簡単にできるので，本格的にPythonを使うのにも良さそう．

## 準備


```{r eval = FALSE}
install.packages("reticulate")
```

```{r, message = FALSE}
library(tidyverse)
library(reticulate)
```

### PythonとPyAutoGUIのインストール

[Pythonとそのライブラリのインストール](#install_python)を参照して，PythonとPyAutoGUIをインストールしておく．


### 使用するPythonの指定

バージョンや形態の異なるPythonを複数インストールすることが可能である．
[Pythonとそのライブラリのインストール](#install_python)で説明したようなPythonパッケージのインストーラを用いたものもあれば，Microsoft Store版のPythonもある．
さらに，Anaconda，Conda，Minicondaなどをインストールしてその中でPythonを使うこともできる．
そのため，reticulateで使用するPythonを指定する．
なお，AnacondaなどのPythonを使う場合は，別途インストールして，`use_condaenv()`で指定する．

```{r}
find_python <- function(){
  os <- get_os()
  python_path <- 
    ifelse(os == "win", "where python", "which python") %>%
    system(intern = TRUE) %>%
    fs::path()
  return(python_path)
}

path <- find_python()
reticulate::use_python(path)
```

## 

```{r}
system("pip list", intern = TRUE) %>%
  tibble::as_tibble()

system("pip install numpy", intern = TRUE)
system("pip install matplotlib", intern = TRUE)
```

```{r}
np <- reticulate::import("numpy") # import numpy as npと同じ
plt <- reticulate::import("matplotlib.pyplot")
```



## PyAutoGUIで画像認識した場所にマウスポインターを動かしてクリックする

<!--
PyAutoGUIで画像認識した場所にマウスポインターを動かしてクリックする
https://take-tech-engineer.com/pyautogui-image/
pyautogui.click('button.png') # Find where button.png appears on the screen and click it.
-->




## PythoとRとの変数のやり取り

variableは変数名

```
  # RからPythonへ(Pythonで取り出し)
r.variable

  # PythonからRへ(Rで取り出し)
py$variable
```

<!--
  ## Pythonでのモジュール(パッケージ)のインストール

Rstudioでpythonを書く (reticulate)
https://qiita.com/Wa__a/items/42129e529cfb6c38e046

py_install()やconda_install()でパッケージがインストールできないとき
- pip でパッケージをインストール   
- pipでインストールできたpythonをreticulate::use_python()で指定
-->


<!--
```
## memo
  # pdf2docxのインストール   
pip install pdf2docx
```

```{r eval = FALSE}
  # pdf2docxの読み込みでエラーになるとき
  #   reticulate::use_python()でpythonを指定
  #   pipでpdf2docxがインストールできたpythonを使う
library(reticulate)
  # reticulate::py_install("pdf2docx") エラー
  # https://anaconda.org/conda-forge/python-docx
  # reticulate::conda_install(channel = "conda-forge", packages = "python-docx")  # できたけど，pdf2docxは読み込めず
reticulate::use_python("C:/Python/Python39/python.exe")
reticulate::py_run_string("from pdf2docx import parse")
reticulate::py_run_string("pdf_file = 'D:/a.pdf'")
reticulate::py_run_string("docx_file = 'D:/a.docx'")
reticulate::py_run_string("parse(pdf_file, docx_file)")
```
-->
