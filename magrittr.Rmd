# magrritrの勧め {#magrittr}


## tidyverseとmagrittr

tidyverseは，Rでのデータ解析には欠かせないものになっている．
そこで，Rを起動時にtidyverseを読み込む人は多いだろう．
なお，tidyverseは1つのライブラリではなく，複数のライブラリからなる．

```{r message = FALSE}
library(tidyverse)
```

これらのライブラリの多く(forcats，tibble，stringr，dplyr，tidyr，purrr)で，`%>%` (パイプ)を使うことができる．
私は`%>%`がtidyverse独自のものだと勘違いをしていた．
しかし，`%>%`はもとはライブラリmagrittrの関数であり，そこからインポートされている．
そのため，tidyverseを読み込むと使うことができる．
`%>%`は，慣れるまでは何が便利なのか分からないが，慣れると欠かせなくなる．
さらに使っていると，癖なってしまって無駄にパイプを繋ぐこともある．
長過ぎるパイプは良くないのは当然であるものの，適度に使うとRでのプログラミングは非常に楽になる．

tidyverseの関数では，引数とするオブジェクトが統一されている．
具体的には，第1引数のオブジェクトがデータフレームやtibbleになっていることが多い．
そのため，パイプと相性が特に良い．


## `%>%`とその仲間

`%>%`の仲間としては，以下の関数もある．

- `%<>%`
- `%T>%`
- `%$%`

これらの関数は，tidyverseには含まれていないため，使用するにはmagrittrを読み込む必要がある．

```{r}
library(magrittr)
```




## `%<>%`

### 使い方

`%<>%`は，パイプを使って処理した内容を，最初のオブジェクトに再度代入するときに使う．
ほんの少しだけ，コードを短くできる．

```{r}
mpg # 燃費データ
tmp <- mpg
tmp <-
  tmp %>%
  dplyr::filter(year==1999) %>%
  tidyr::separate(trans, into=c("trans1", "trans2", NA)) %>%
  print()

tmp <- mpg
tmp %<>%
  dplyr::filter(year==1999) %>%
  tidyr::separate(trans, into=c("trans1", "trans2", NA)) %>%
  print()
```

### 注意点

試行錯誤でコードを書いている途中は，あまり使わないほうが良いだろう．
もとのオブジェクトが置き換わるので，処理結果が求めるものでないときに，もとに戻れないためである．


## `%T>%`

### 使い方

処理途中に分岐をして別の処理をさせたいときに使う．
ちょっとだけ処理して，変数に保存するとき
imapと組み合わせると便利かも
画像を保存するファイル名の設定とか


```{r}
mpg # 燃費データ

```

### 注意点

分岐途中の結果をオブジェクトに代入するときには，`<-`ではなく，`<<-`を使用する．
明示的に「.」を使う
複数処理があれば，「{}」で囲う
処理終了後に「%>%」が必要
  例のコードを示す

```{r}

#  mpg %T>%
#    {
#      tmp <<- dplyr::select(., ) 
#    } %>%

  
```

## `%$%`


### 使い方


```{r}
mpg %>%
  .$manufacturer

mpg %$%
  manufacturer
```


### 注意点



